                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                ;   Tablacus DOS call for MSX
                                ;   Gaku
                                
                                    INCLUDE "DEF.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       0010                     VER_BCD EQU 00010H
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       0402                     MAPPER  EQU 00402H
                                
       F307                     FCB11   EQU 0F307H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F398                     JP_IX   EQU 0F398H
       F389                     ENASLT_NOEXT    EQU 0F389H
       F3AF                     LINL32  EQU 0F3AFH
       F3AE                     LINL40  EQU 0F3AEH
       F3B0                     LINLEN  EQU 0F3B0H
                                
       F41F                     KBUF    EQU 0F41FH; 318
       F55E                     BUF EQU 0F55EH; 258
                                
       F662                     DIMFLG  EQU 0F662H
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F676                     TXTTAB  EQU 0F676H
       F6A7                     TEMP    EQU 0F6A7H
       F6AF                     SAVTXT  EQU 0F6AFH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6B5                     DOT EQU 0F6B5H
       F6B9                     ONELIN  EQU 0F6B9H
                                
       F7F6                     DAC EQU 0F7F6H
       F7F8                     DACDAT  EQU DAC+2
                                
       FAF8                     EXBRSA  EQU 0FAF8H
                                
       FB20                     HOKVLD  EQU 0FB20H
                                
       FC9B                     INTFLG  EQU 0FC9BH
       FCA9                     CSRSW   EQU 0FCA9H
       FCC1                     EXPTBL  EQU 0FCC1H
       FCC5                     SLTTBL  EQU 0FCC5H
                                
       FE0D                     H_CMD   EQU 0FE0DH
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
       DE00                     START   EQU 0DE00H
                                
       DD06                     BUF512  EQU TERM-512    ;_RDABS _WRABS のバッファ
       DD03                     BDOS0   EQU BUF512-3
       DD06                     ALT_MEM EQU BUF512
       DD46                     ALT_MEM2    EQU ALT_MEM+64
       DD86                     ALT_MEM3    EQU ALT_MEM2+64
       DD06                     FDRV    EQU BUF512
       DD07                     FNAME   EQU BUF512+1
       DD2B                     BUFSTR  EQU BUF512+37
       DE06                     COMSTR  EQU BUF512+256
                                
       E400                     SPBUF   EQU CPM_BOOT
[EOF:DEF.ASM:UTF_8]
                                
000000 DDF9                         ORG START-7
                                
                                ;   MSX BINARY HEADER
000000 DDF9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 DDFA 00DE                    DW  START
                                ;   MSX BINARY END ADDRESS
000003 DDFC 0FE4                    DW  LAST
                                ;   MSX BINARY EXEC ADDRESS
000005 DDFE 00DE                    DW  START
                                
000007 DE00                         ORG START
                                
                                    INCLUDE "INIT.ASM"
                                ;
                                ;   Tablacus DOS cmd 2
                                ;
000007 DE00 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
000009 DE02 CD7DF3          17      CALL    BDOS
00000C DE05 78               4      LD  A,B
00000D DE06 B7               4      OR  A
00000E DE07 C8              11      RET Z       ;DOS2専用
                                
00000F DE08 3A20FB          13      LD  A,(HOKVLD)
000012 DE0B E601             7      AND 1
000014 DE0D C8              11      RET Z       ;拡張BIOSが存在しない
                                
000015 DE0E AF               4      XOR A
000016 DE0F 110104          10      LD  DE,00401H   ;D=デバイスID
000019 DE12 CDCAFF          17      CALL    EXTBIO
00001C DE15 B7               4      OR  A
00001D DE16 C8              11      RET Z       ;マッパーサポートルーチンが存在しない
00001E DE17 2217E4          16      LD  (MMAP_TABLE_PTR),HL
                                
000021 DE1A 110204          10      LD  DE,00402H   ;D=デバイスID
000024 DE1D CDCAFF          17      CALL    EXTBIO
                                
000027 DE20 1119E4          10      LD  DE,MAPPER_JUMP_TABLE
00002A DE23 010130          10      LD  BC,16*3*256+1
00002D DE26 EB               4      EX  DE,HL
       DE27                     SET_MJT:
00002E DE27 1A               7      LD  A,(DE)
00002F DE28 13               6      INC DE
000030 DE29 BE               7      CP  (HL)
000031 DE2A 2803            12      JR  Z,SET_MJT1
000033 DE2C 77               7      LD  (HL),A
000034 DE2D 0E00             7      LD  C,0
       DE2F                     SET_MJT1:
000036 DE2F 23               6      INC HL
000037 DE30 10F5            13      DJNZ    SET_MJT
                                
000039 DE32 0D               4      DEC C       ;マッパーサポートルーチンがすでにインストールされている
00003A DE33 C8              11      RET Z
                                
00003B DE34 110FE4          10      LD  DE,RAM_TABLE
00003E DE37 2600             7      LD  H,0
       DE39                     SET_TABLE:          ;現在のRAMの状況をRAM_TABLEに取得
000040 DE39 CD2EE4          17      CALL    MAPPER_GET_PH
000043 DE3C 12               7      LD  (DE),A
000044 DE3D 13               6      INC DE
000045 DE3E 09              11      ADD HL,BC
000046 DE3F 7C               4      LD  A,H
000047 DE40 C640             7      ADD A,040H
000049 DE42 67               4      LD  H,A
00004A DE43 30F4            12      JR  NC,SET_TABLE
       DE45                     GET_MAPPER_RAM:         ;新たに64KB RAMを取得する
00004C DE45 3E01             7      LD  A,1         ;システムセグメントとして取得する
00004E DE47 0600             7      LD  B,0         ;プライマリーマッパーから確保する
000050 DE49 CD19E4          17      CALL    MAPPER_ALL_SEG
000053 DE4C D8              11      RET C           ;CF=1 : 空きセグメントが無い
000054 DE4D 12               7      LD  (DE),A
000055 DE4E 13               6      INC DE
000056 DE4F 7C               4      LD  A,H
000057 DE50 C640             7      ADD A,040H
000059 DE52 67               4      LD  H,A
00005A DE53 30F0            12      JR  NC,GET_MAPPER_RAM
                                                ;DOSのページ 0を初期化
00005C DE55 F3               4      DI
00005D DE56 2640             7      LD  H,040H
00005F DE58 3A43F3          13      LD  A,(RAMAD2)
000062 DE5B CD2400          17      CALL    _ENASLT
                                
000065 DE5E 2680             7      LD  H,080H
000067 DE60 3A13E4          13      LD  A,(DOS_RAM_0)
00006A DE63 CD2BE4          17      CALL    MAPPER_PUT_PH
                                
00006D DE66 210040          10      LD  HL,04000H
000070 DE69 3A0FE4          13      LD  A,(BASIC_RAM_0)
000073 DE6C CD2BE4          17      CALL    MAPPER_PUT_PH
                                
000076 DE6F 110080          10      LD  DE,08000H
000079 DE72 010001          10      LD  BC,00100H
00007C DE75 EDB0                    LDIR
                                
00007E DE77 3E                      DB  03EH    ;LD A,?
00007F DE78 F1              10      POP AF
000080 DE79 320DFE          13      LD  (H_CMD),A
                                
000083 DE7C 3EC3             7      LD  A,0C3H      ;JP
                                
000085 DE7E 2103E4          10      LD  HL,CPM_WBOOT
000088 DE81 320080          13      LD  (08000H),A
00008B DE84 220180          16      LD  (08001H),HL
                                
00008E DE87 2103DD          10      LD  HL,BDOS0
000091 DE8A 320580          13      LD  (08005H),A
000094 DE8D 220680          16      LD  (08006H),HL
                                
000097 DE90 2112DF          10      LD  HL,BDOS1
00009A DE93 3203DD          13      LD  (BDOS0),A
00009D DE96 2204DD          16      LD  (BDOS0+1),HL
                                
0000A0 DE99 320EFE          13      LD  (H_CMD+1),A
0000A3 DE9C 21AFE1          10      LD  HL,_CMD
0000A6 DE9F 220FFE          16      LD  (H_CMD+2),HL
                                
0000A9 DEA2 2640             7      LD  H,040H
0000AB DEA4 3A10E4          13      LD  A,(BASIC_RAM_1)
0000AE DEA7 CD2BE4          17      CALL    MAPPER_PUT_PH
                                
0000B1 DEAA 2680             7      LD  H,080H
0000B3 DEAC 3A11E4          13      LD  A,(BASIC_RAM_2)
0000B6 DEAF CD2BE4          17      CALL    MAPPER_PUT_PH
                                
0000B9 DEB2 2640             7      LD  H,040H
0000BB DEB4 3AC1FC          13      LD  A,(EXPTBL)
0000BE DEB7 CD2400          17      CALL    _ENASLT
0000C1 DEBA FB               4      EI
0000C2 DEBB 11C3DE          10      LD  DE,TITLE
0000C5 DEBE 0E09             7      LD  C,9
0000C7 DEC0 C37DF3          10      JP  BDOS
                                
                                ; Version
       DEC3                     TITLE:
0000CA DEC3 5461626C61637573        DB  "Tablacus DOS cmd 2 v0.10"
            20444F5320636D64    
            20322076302E3130    
0000E2 DEDB 0D0A24                  DB  00DH,00AH,'$'
[EOF:INIT.ASM:UTF_8]
                                
00010D DF06                         ORG START+0106H
                                    INCLUDE "DOS.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       DF06                     TERM:
00010D DF06 78               4      LD  A,B
00010E DF07 32ADE3          13      LD  (TERMCODE),A
000111 DF0A 210000          10      LD  HL,0
000114 DF0D E5              11      PUSH    HL
000115 DF0E 2A9FE1          16      LD  HL,(DEFAB)
000118 DF11 E9               4      JP  (HL)
       DF12                     BDOS1:
000119 DF12 0C               4      INC C
00011A DF13 0D               4      DEC C
                                                ;BDOS0+013Hを0にするとバッチ停止されるため0が書き込みされる場合がある
00011B DF14 CA0000          10      JP  Z,0     ;だから、ここのアドレスをBDOS0+011HもしくはBDOS0+012Hにする
00011E DF17 ED73ADE1        20      LD  (SAVE_SP),SP
000122 DF1B 329AE1          13      LD  (SAVE_A),A
000125 DF1E DD22A5E1        20      LD  (SAVE_IX),IX
000129 DF22 FD22A7E1        20      LD  (SAVE_IY),IY
00012D DF26 79               4      LD  A,C
00012E DF27 FE62             7      CP  062H        ;_TERM エラーコードを返して終了
000130 DF29 28DB            12      JR  Z,TERM
000132 DF2B 3AAEE1          13      LD  A,(SAVE_SP+1)
000135 DF2E 87               4      ADD A,A
000136 DF2F 3803            12      JR  C,BDOS_SPOK
000138 DF31 3100E4          10      LD  SP,SPBUF
       DF34                     BDOS_SPOK:
00013B DF34 79               4      LD  A,C
00013C DF35 FE09             7      CP  9       ;_STROUT 文字列出力
00013E DF37 CAF6E0          10      JP  Z,_SYS09
000141 DF3A FE63             7      CP  063H        ;_DEFAB アボート終了ルーチンの定義
000143 DF3C 2004            12      JR  NZ,BDOS2
000145 DF3E ED539FE1        20      LD  (DEFAB),DE
       DF42                     BDOS2:
000149 DF42 FE1A             7      CP  01AH        ;_SETDTA DTAの設定
00014B DF44 2004            12      JR  NZ,BDOS2_
00014D DF46 ED53A1E1        20      LD  (_DTA),DE
       DF4A                     BDOS2_:
000151 DF4A 32A3E1          13      LD  (SAVE_C),A
000154 DF4D FE0F             7      CP  00FH        ;_FOPEN ファイルオープン
000156 DF4F 3859            12      JR  C,SAVEFCB0
000158 DF51 FE12             7      CP  012H        ;_SNEXT ファイル検索 続き
00015A DF53 2004            12      JR  NZ,NOBD12
00015C DF55 ED5B07F3        20      LD  DE,(FCB11)
       DF59                     NOBD12:
000160 DF59 FE18             7      CP  018H        ;_LOGIN ログインベクトルの獲得
000162 DF5B 383A            12      JR  C,SAVEFCB36
000164 DF5D FE21             7      CP  021H        ;_RDRND ランダム読み出し
000166 DF5F 3849            12      JR  C,SAVEFCB0
000168 DF61 FE29             7      CP  028H+1      ;_WRZER ゼロ書き込みを伴うランダム書き込み+1
00016A DF63 3832            12      JR  C,SAVEFCB36
00016C DF65 FE31             7      CP  031H        ;_DPARM ディスクパラメータの獲得
00016E DF67 282E            12      JR  Z,SAVEFCB36
000170 DF69 FE40             7      CP  040H        ;_FFIRST 最初のエントリ検索
000172 DF6B 282A            12      JR  Z,SAVE_PATH
000174 DF6D FE42             7      CP  042H        ;_FNEW 新しいエントリの検索
000176 DF6F 2826            12      JR  Z,SAVE_PATH
000178 DF71 FE43             7      CP  043H        ;_OPEN ファイルハンドルのオープン
00017A DF73 2822            12      JR  Z,SAVE_PATH
00017C DF75 FE44             7      CP  044H        ;_CREATE ファイルハンドルの作成
00017E DF77 281E            12      JR  Z,SAVE_PATH
000180 DF79 FE4C             7      CP  04CH        ;_HTEST ファイルハンドルの検査
000182 DF7B 281A            12      JR  Z,SAVE_PATH
000184 DF7D FE4D             7      CP  04DH        ;_DELETE ファイル、サブディレクトリの削除
000186 DF7F 3829            12      JR  C,SAVEFCB0
000188 DF81 FE52             7      CP  051H+1      ;_FTIME ファイルの日付および時刻の獲得・設定
00018A DF83 3812            12      JR  C,SAVE_PATH
00018C DF85 FE59             7      CP  059H        ;_GETCD カレントディレクトリの獲得
00018E DF87 3821            12      JR  C,SAVEFCB0
000190 DF89 FE5D             7      CP  05CH+1      ;_PFILE ファイル名の解析+1
000192 DF8B 380A            12      JR  C,SAVE_PATH
000194 DF8D FE5E             7      CP  05EH        ;_WPATH パス文字列全体の獲得
000196 DF8F 2806            12      JR  Z,SAVE_PATH
000198 DF91 FE66             7      CP  066H        ;_EXPLAIN エラーコードの説明
00019A DF93 2802            12      JR  Z,SAVE_PATH
00019C DF95 1813            12      JR  SAVEFCB0
       DF97                     SAVEFCB36:
       DF97                     SAVE_PATH:
00019E DF97 7A               4      LD  A,D
00019F DF98 FE3F             7      CP  03FH        ;ページ1にかぶる？
0001A1 DF9A 380E            12      JR  C,SAVEFCB0
0001A3 DF9C FE80             7      CP  080H
0001A5 DF9E 300A            12      JR  NC,SAVEFCB0
0001A7 DFA0 3E24             7      LD  A,36
0001A9 DFA2 CB71             8      BIT 6,C     ;DOS2のファンクションコール？
0001AB DFA4 2805            12      JR  Z,SAVEFCB1
0001AD DFA6 3E40             7      LD  A,64        ;DOS2CALLは64バイト設定する
0001AF DFA8 1801            12      JR  SAVEFCB1
       DFAA                     SAVEFCB0:
0001B1 DFAA AF               4      XOR A
       DFAB                     SAVEFCB1:
0001B2 DFAB 329BE1          13      LD  (DE_MEM_SIZE),A
0001B5 DFAE B7               4      OR  A
0001B6 DFAF 2815            12      JR  Z,BDOS3
0001B8 DFB1 C5              11      PUSH    BC
0001B9 DFB2 E5              11      PUSH    HL
0001BA DFB3 ED53A9E1        20      LD  (SAVE_DE),DE
0001BE DFB7 4F               4      LD  C,A
0001BF DFB8 0600             7      LD  B,0
0001C1 DFBA 2106DD          10      LD  HL,ALT_MEM
0001C4 DFBD EB               4      EX  DE,HL
0001C5 DFBE D5              11      PUSH    DE
0001C6 DFBF EDB0                    LDIR
0001C8 DFC1 AF               4      XOR A
0001C9 DFC2 12               7      LD  (DE),A
0001CA DFC3 D1              10      POP DE
0001CB DFC4 E1              10      POP HL
0001CC DFC5 C1              10      POP BC
       DFC6                     BDOS3:
0001CD DFC6 AF               4      XOR A
0001CE DFC7 32A4E1          13      LD  (IS_SAVE_IX_VAUE),A
0001D1 DFCA 79               4      LD  A,C
0001D2 DFCB FE40             7      CP  040H        ;最初のエントリ検索
0001D4 DFCD 3825            12      JR  C,BDOS3IX   ;次のエントリ検索
0001D6 DFCF FE43             7      CP  042H+1      ;新しいエントリの検索
0001D8 DFD1 3021            12      JR  NC,BDOS3IX
0001DA DFD3 DD7C             9      LD  A,IXH
0001DC DFD5 FE3F             7      CP  03FH        ;ページ1にかぶる？
0001DE DFD7 381B            12      JR  C,BDOS3IX
0001E0 DFD9 FE80             7      CP  080H        ;
0001E2 DFDB 3017            12      JR  NC,BDOS3IX
0001E4 DFDD 32A4E1          13      LD  (IS_SAVE_IX_VAUE),A
0001E7 DFE0 C5              11      PUSH    BC
0001E8 DFE1 D5              11      PUSH    DE
0001E9 DFE2 E5              11      PUSH    HL
0001EA DFE3 DDE5            15      PUSH    IX
0001EC DFE5 E1              10      POP HL
0001ED DFE6 1146DD          10      LD  DE,ALT_MEM2
0001F0 DFE9 014000          10      LD  BC,64
0001F3 DFEC D5              11      PUSH    DE
0001F4 DFED EDB0                    LDIR
0001F6 DFEF DDE1            14      POP IX
0001F8 DFF1 E1              10      POP HL
0001F9 DFF2 D1              10      POP DE
0001FA DFF3 C1              10      POP BC
       DFF4                     BDOS3IX:
0001FB DFF4 AF               4      XOR A
0001FC DFF5 32ACE1          13      LD  (SAVE_HL+1),A
0001FF DFF8 79               4      LD  A,C
000200 DFF9 FE4E             7      CP  4EH     ;_RENAME ファイルあるいはサブディレクトリ名の変更
000202 DFFB 281C            12      JR  Z,SAVE_HL1
000204 DFFD FE4F             7      CP  4FH     ;_MOVE ファイルあるいはサブディレクトリの移動
000206 DFFF 2818            12      JR  Z,SAVE_HL1
000208 E001 FE53             7      CP  53H     ;_HRENAME ファイルハンドルの名前の変更
00020A E003 2814            12      JR  Z,SAVE_HL1
00020C E005 FE54             7      CP  54H     ;_HMOVE ファイルハンドルの移動
00020E E007 2810            12      JR  Z,SAVE_HL1
000210 E009 FE5C             7      CP  05CH        ;_PFILE ファイル名の解析
000212 E00B 280C            12      JR  Z,SAVE_HL1
000214 E00D FE40             7      CP  040H        ;_FFIRST 最初のエントリ検索
000216 E00F 2804            12      JR  Z,FIBCHECK
000218 E011 FE42             7      CP  042H        ;_FNEW 新しいエントリ検索
00021A E013 201F            12      JR  NZ,BDOS3HL
       E015                     FIBCHECK:
00021C E015 1A               7      LD  A,(DE)
00021D E016 3C               4      INC A       ;DEがFIBならば0FFH
00021E E017 201B            12      JR  NZ,BDOS3HL
       E019                     SAVE_HL1:
000220 E019 7C               4      LD  A,H
000221 E01A FE3F             7      CP  03FH        ;ページ1にかぶる？
000223 E01C 3816            12      JR  C,BDOS3HL
000225 E01E FE80             7      CP  080H        ;
000227 E020 3012            12      JR  NC,BDOS3HL
000229 E022 22ABE1          16      LD  (SAVE_HL),HL
00022C E025 C5              11      PUSH    BC
00022D E026 D5              11      PUSH    DE
00022E E027 014000          10      LD  BC,64
000231 E02A 1186DD          10      LD  DE,ALT_MEM3
000234 E02D EDB0                    LDIR
000236 E02F D1              10      POP DE
000237 E030 C1              10      POP BC
000238 E031 2186DD          10      LD  HL,ALT_MEM3
       E034                     BDOS3HL:
00023B E034 79               4      LD  A,C
00023C E035 FE2F             7      CP  02FH
00023E E037 CA13E1          10      JP  Z,RDABS
000241 E03A FE30             7      CP  030H
000243 E03C CA5FE1          10      JP  Z,WRABS
       E03F                     BDOS_EXEC:
000246 E03F 3A9AE1          13      LD  A,(SAVE_A)
000249 E042 CD7DF3          17      CALL    BDOS
                                
00024C E045 F5              11      PUSH    AF
00024D E046 3AA3E1          13      LD  A,(SAVE_C)
000250 E049 FE1B             7      CP  01BH            ;アロケーション情報の獲得
000252 E04B 2823            12      JR  Z,BDOS4IX
000254 E04D FE6F             7      CP  06FH            ;MSX-DOSのバージョン番号の獲得
000256 E04F 281F            12      JR  Z,BDOS4IX
000258 E051 DD2AA5E1        20      LD  IX,(SAVE_IX)
00025C E055 FD2AA7E1        20      LD  IY,(SAVE_IY)
000260 E059 3AA4E1          13      LD  A,(IS_SAVE_IX_VAUE)     ;最初のエントリ検索 + 次のエントリ検索
000263 E05C B7               4      OR  A
000264 E05D 2811            12      JR  Z,BDOS4IX
000266 E05F C5              11      PUSH    BC
000267 E060 D5              11      PUSH    DE
000268 E061 E5              11      PUSH    HL
000269 E062 DDE5            15      PUSH    IX
00026B E064 D1              10      POP DE
00026C E065 2146DD          10      LD  HL,ALT_MEM2
00026F E068 014000          10      LD  BC,64
000272 E06B EDB0                    LDIR
000274 E06D E1              10      POP HL
000275 E06E D1              10      POP DE
000276 E06F C1              10      POP BC
       E070                     BDOS4IX:
000277 E070 3A9BE1          13      LD  A,(DE_MEM_SIZE)
00027A E073 B7               4      OR  A
00027B E074 2812            12      JR  Z,BDOS4
00027D E076 C5              11      PUSH    BC
00027E E077 D5              11      PUSH    DE
00027F E078 E5              11      PUSH    HL
000280 E079 4F               4      LD  C,A
000281 E07A 0600             7      LD  B,0
000283 E07C 2106DD          10      LD  HL,ALT_MEM
000286 E07F ED5BA9E1        20      LD  DE,(SAVE_DE)
00028A E083 EDB0                    LDIR
00028C E085 E1              10      POP HL
00028D E086 D1              10      POP DE
00028E E087 C1              10      POP BC
       E088                     BDOS4:
00028F E088 3AACE1          13      LD  A,(SAVE_HL+1)
000292 E08B B7               4      OR  A
000293 E08C 2812            12      JR  Z,BDOS5
000295 E08E C5              11      PUSH    BC
000296 E08F D5              11      PUSH    DE
000297 E090 E5              11      PUSH    HL
000298 E091 010B00          10      LD  BC,11
00029B E094 2186DD          10      LD  HL,ALT_MEM3
00029E E097 ED5BABE1        20      LD  DE,(SAVE_HL)
0002A2 E09B EDB0                    LDIR
0002A4 E09D E1              10      POP HL
0002A5 E09E D1              10      POP DE
0002A6 E09F C1              10      POP BC
       E0A0                     BDOS5:
0002A7 E0A0 3AA3E1          13      LD  A,(SAVE_C)
0002AA E0A3 FE6F             7      CP  06FH        ;_DOSVER MSX-DOSのバージョン番号の獲得
0002AC E0A5 2013            12      JR  NZ,BDOS7
0002AE E0A7 04               4      INC B
0002AF E0A8 05               4      DEC B
0002B0 E0A9 2802            12      JR  Z,S6F_1
0002B2 E0AB 59               4      LD  E,C     ;DOS2の場合
0002B3 E0AC 50               4      LD  D,B     ;MSXDOS2.SYSのバージョンをカーネルに合わす
       E0AD                     S6F_1:
0002B4 E0AD DD25            10      DEC IXH     ;NEXTOR判別
0002B6 E0AF 2807            12      JR  Z,NEXTOR
0002B8 E0B1 DD21EDEC        14      LD  IX,0ECEDH   ;似非DOS判別用(INC IXがあるのでIXが0EDEDHになる)
0002BC E0B5 211000          10      LD  HL,VER_BCD  ;NEXTORじゃない場合はHLに似非DOSのバージョンが返る
       E0B8                     NEXTOR:
0002BF E0B8 DD24            10      INC IXH
       E0BA                     BDOS7:
0002C1 E0BA FE5B             7      CP  05BH        ;_PARSE パス名の解析
0002C3 E0BC 2804            12      JR  Z,BDOS8
0002C5 E0BE FE5E             7      CP  05EH        ;_WPATH パス文字列全体の獲得
0002C7 E0C0 201E            12      JR  NZ,BDOS6
       E0C2                     BDOS8:
0002C9 E0C2 3A9BE1          13      LD  A,(DE_MEM_SIZE)
0002CC E0C5 2819            12      JR  Z,BDOS6
0002CE E0C7 C5              11      PUSH    BC
0002CF E0C8 0106DD          10      LD  BC,ALT_MEM
0002D2 E0CB ED42            15      SBC HL,BC       ;CF=0のハズ
0002D4 E0CD ED4BA9E1        20      LD  BC,(SAVE_DE)
0002D8 E0D1 09              11      ADD HL,BC
0002D9 E0D2 EB               4      EX  DE,HL
0002DA E0D3 0106DD          10      LD  BC,ALT_MEM
0002DD E0D6 A7               4      AND A       ;念のためにCF=0にする
0002DE E0D7 ED42            15      SBC HL,BC
0002E0 E0D9 ED4BA9E1        20      LD  BC,(SAVE_DE)
0002E4 E0DD 09              11      ADD HL,BC
0002E5 E0DE EB               4      EX  DE,HL
0002E6 E0DF C1              10      POP BC
       E0E0                     BDOS6:
0002E7 E0E0 F1              10      POP AF
0002E8 E0E1 ED7BADE1        20      LD  SP,(SAVE_SP)
0002EC E0E5 C9              10      RET
                                
       E0E6                     CONST1:
0002ED E0E6 0E0B             7      LD  C,0BH
0002EF E0E8 C30500          10      JP  SYSTEM
       E0EB                     CONIN1:
0002F2 E0EB 0E07             7      LD  C,7
0002F4 E0ED C30500          10      JP  SYSTEM
       E0F0                     CONOUT1:
0002F7 E0F0 59               4      LD  E,C
0002F8 E0F1 0E02             7      LD  C,2
0002FA E0F3 C30500          10      JP  SYSTEM
                                
       E0F6                     _SYS09:     ;_STROUT 文字列出力
0002FD E0F6 1A               7      LD  A,(DE)
0002FE E0F7 13               6      INC DE
0002FF E0F8 FE24             7      CP  '$'
000301 E0FA 280A            12      JR  Z,S09X1
000303 E0FC D5              11      PUSH    DE
000304 E0FD 0E02             7      LD  C,2
000306 E0FF 5F               4      LD  E,A
000307 E100 CD7DF3          17      CALL    BDOS
00030A E103 D1              10      POP DE
00030B E104 18F0            12      JR  _SYS09
                                
       E106                     S09X1:
00030D E106 ED7BADE1        20      LD  SP,(SAVE_SP)
000311 E10A DD2AA5E1        20      LD  IX,(SAVE_IX)
000315 E10E FD2AA7E1        20      LD  IY,(SAVE_IY)
000319 E112 C9              10      RET
                                
       E113                     RDABS:
00031A E113 3AA2E1          13      LD  A,(_DTA+1)
00031D E116 87               4      ADD A,A
00031E E117 DA3FE0          10      JP  C,BDOS_EXEC
                                
000321 E11A D5              11      PUSH    DE
000322 E11B E5              11      PUSH    HL
000323 E11C 1106DD          10      LD  DE,BUF512
000326 E11F 0E1A             7      LD  C,01AH      ;_SETDTA
000328 E121 CD7DF3          17      CALL    BDOS
00032B E124 E1              10      POP HL
00032C E125 D1              10      POP DE
                                
00032D E126 ED4BA1E1        20      LD  BC,(_DTA)
       E12A                     RDABS1:
000331 E12A D5              11      PUSH    DE
000332 E12B E5              11      PUSH    HL
000333 E12C C5              11      PUSH    BC
000334 E12D 2601             7      LD  H,1
000336 E12F 0E2F             7      LD  C,02FH      ;_RDABS
000338 E131 CD7DF3          17      CALL    BDOS
00033B E134 E1              10      POP HL      ;<=転送先
00033C E135 FEFF             7      CP  0FFH
00033E E137 2814            12      JR  Z,RDABS_ERR
000340 E139 EB               4      EX  DE,HL
000341 E13A 2106DD          10      LD  HL,BUF512
000344 E13D 010002          10      LD  BC,512
000347 E140 EDB0                    LDIR
000349 E142 4B               4      LD  C,E
00034A E143 42               4      LD  B,D
00034B E144 E1              10      POP HL
00034C E145 D1              10      POP DE
00034D E146 13               6      INC DE
00034E E147 25               4      DEC H
00034F E148 20E0            12      JR  NZ,RDABS1
       E14A                     WRABS_OK:
000351 E14A AF               4      XOR A
       E14B                     WRABS_ERR:
000352 E14B D5              11      PUSH    DE
000353 E14C E5              11      PUSH    HL
       E14D                     RDABS_ERR:
000354 E14D F5              11      PUSH    AF
000355 E14E ED5BA1E1        20      LD  DE,(_DTA)
000359 E152 0E1A             7      LD  C,01AH      ;_SETDTA
00035B E154 CD7DF3          17      CALL    BDOS
00035E E157 F1              10      POP AF
00035F E158 E1              10      POP HL
000360 E159 D1              10      POP DE
000361 E15A ED7BADE1        20      LD  SP,(SAVE_SP)
000365 E15E C9              10      RET
                                
       E15F                     WRABS:
000366 E15F 3AA2E1          13      LD  A,(_DTA+1)
000369 E162 87               4      ADD A,A
00036A E163 DA3FE0          10      JP  C,BDOS_EXEC
00036D E166 D5              11      PUSH    DE
00036E E167 E5              11      PUSH    HL
00036F E168 1106DD          10      LD  DE,BUF512
000372 E16B 0E1A             7      LD  C,01AH      ;_SETDTA
000374 E16D CD7DF3          17      CALL    BDOS
000377 E170 E1              10      POP HL
000378 E171 D1              10      POP DE
                                
000379 E172 ED4BA1E1        20      LD  BC,(_DTA)
       E176                     WRABS1:
00037D E176 D5              11      PUSH    DE
00037E E177 E5              11      PUSH    HL
00037F E178 69               4      LD  L,C
000380 E179 60               4      LD  H,B
000381 E17A 1106DD          10      LD  DE,BUF512
000384 E17D 010002          10      LD  BC,512
000387 E180 EDB0                    LDIR
000389 E182 E3              19      EX  (SP),HL
00038A E183 D1              10      POP DE
                                
00038B E184 D5              11      PUSH    DE
00038C E185 E5              11      PUSH    HL
00038D E186 2601             7      LD  H,1
00038F E188 0E30             7      LD  C,030H      ;_WRABS
000391 E18A CD7DF3          17      CALL    BDOS
000394 E18D E1              10      POP HL
000395 E18E D1              10      POP DE
000396 E18F C1              10      POP BC
000397 E190 FEFF             7      CP  0FFH
000399 E192 28B7            12      JR  Z,WRABS_ERR
00039B E194 13               6      INC DE
00039C E195 25               4      DEC H
00039D E196 20DE            12      JR  NZ,WRABS1
00039F E198 18B0            12      JR  WRABS_OK
                                
       E19A                     SAVE_A:
0003A1 E19A 00                      DB  0
       E19B                     DE_MEM_SIZE:
0003A2 E19B 0000                    DW  0
       E19D                     EXTSP:
0003A4 E19D 0000                    DW  0
       E19F                     DEFAB:
0003A6 E19F 0000                    DW  0
       E1A1                     _DTA:
0003A8 E1A1 0000                    DW  0
       E1A3                     SAVE_C:
0003AA E1A3 00                      DB  0
       E1A4                     IS_SAVE_IX_VAUE:
0003AB E1A4 00                      DB  0
       E1A5                     SAVE_IX:
0003AC E1A5 0000                    DW  0
       E1A7                     SAVE_IY:
0003AE E1A7 0000                    DW  0
       E1A9                     SAVE_DE:
0003B0 E1A9 0000                    DW  0
       E1AB                     SAVE_HL:
0003B2 E1AB 0000                    DW  0
       E1AD                     SAVE_SP:
0003B4 E1AD 0000                    DW  0
[EOF:DOS.ASM:UTF_8]
                                    INCLUDE "CMD.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
       E1AF                     _CMD:
0003B6 E1AF F3               4      DI
0003B7 E1B0 CD644C          17      CALL    FRMEVL
0003BA E1B3 E5              11      PUSH    HL
0003BB E1B4 2680             7      LD  H,080H          ;ページ3をバックアップ
0003BD E1B6 3A16E4          13      LD  A,(BACKUP_RAM_3)
0003C0 E1B9 CD2BE4          17      CALL    MAPPER_PUT_PH
0003C3 E1BC 2100C0          10      LD  HL,0C000H
0003C6 E1BF 110080          10      LD  DE,08000H
0003C9 E1C2 01031D          10      LD  BC,BDOS0-0C000H
0003CC E1C5 EDB0                    LDIR
0003CE E1C7 2680             7      LD  H,080H
0003D0 E1C9 3A11E4          13      LD  A,(BASIC_RAM_2)
0003D3 E1CC CD2BE4          17      CALL    MAPPER_PUT_PH
0003D6 E1CF E1              10      POP HL
0003D7 E1D0 E5              11      PUSH    HL
0003D8 E1D1 ED73AEE3        20      LD  (BASSP),SP
                                
0003DC E1D5 CDD067          17      CALL    FRESTR
0003DF E1D8 0600             7      LD  B,0
0003E1 E1DA 4E               7      LD  C,(HL)
0003E2 E1DB 23               6      INC HL
0003E3 E1DC 7E               7      LD  A,(HL)
0003E4 E1DD 23               6      INC HL
0003E5 E1DE 66               7      LD  H,(HL)
0003E6 E1DF 6F               4      LD  L,A
0003E7 E1E0 112BDD          10      LD  DE,BUFSTR
0003EA E1E3 79               4      LD  A,C
0003EB E1E4 B7               4      OR  A
0003EC E1E5 CACDE2          10      JP  Z,WBOOT1
0003EF E1E8 EDB0                    LDIR
0003F1 E1EA AF               4      XOR A
0003F2 E1EB 12               7      LD  (DE),A
                                
0003F3 E1EC 2640             7      LD  H,040H
0003F5 E1EE 3A14E4          13      LD  A,(DOS_RAM_1)
0003F8 E1F1 CD2BE4          17      CALL    MAPPER_PUT_PH
0003FB E1F4 3A42F3          13      LD  A,(RAMAD1)
0003FE E1F7 CD2400          17      CALL    _ENASLT     ;ページ1をRAMに切り替える
                                
000401 E1FA 2158E3          10      LD  HL,ENASLT_00H
000404 E1FD 110040          10      LD  DE,04000H
000407 E200 013D00          10      LD  BC,ENASLT_00H_E-ENASLT_00H
00040A E203 EDB0                    LDIR
                                
00040C E205 2600             7      LD  H,000H
00040E E207 3A13E4          13      LD  A,(DOS_RAM_0)
000411 E20A CD2BE4          17      CALL    MAPPER_PUT_PH
000414 E20D 3A41F3          13      LD  A,(RAMAD0)
000417 E210 CD0040          17      CALL    04000H  ;ページ0をRAMに切り替える
                                
00041A E213 2680             7      LD  H,080H
00041C E215 3A15E4          13      LD  A,(DOS_RAM_2)
00041F E218 CD2BE4          17      CALL    MAPPER_PUT_PH   ;ページ2をDOSのRAMに切り替える
                                
000422 E21B 2106DD          10      LD  HL,FDRV
000425 E21E 0625             7      LD  B,37
000427 E220 AF               4      XOR A
       E221                     ZERO_FCB:
000428 E221 77               7      LD  (HL),A
000429 E222 23               6      INC HL
00042A E223 10FC            13      DJNZ    ZERO_FCB
                                
00042C E225 112BDD          10      LD  DE,BUFSTR
00042F E228 CD12E3          17      CALL    FILE
000432 E22B D5              11      PUSH    DE
                                
000433 E22C 1A               7      LD  A,(DE)
000434 E22D F5              11      PUSH    AF
000435 E22E EB               4      EX  DE,HL
000436 E22F 112BDD          10      LD  DE,BUFSTR
000439 E232 AF               4      XOR A
00043A E233 ED52            15      SBC HL,DE
00043C E235 4D               4      LD  C,L
00043D E236 44               4      LD  B,H
00043E E237 212BDD          10      LD  HL,BUFSTR
000441 E23A 1106DE          10      LD  DE,COMSTR
000444 E23D EDB0                    LDIR
000446 E23F 21A8E3          10      LD  HL,COM_EXT
000449 E242 010500          10      LD  BC,5
00044C E245 EDB0                    LDIR
00044E E247 2195E3          10      LD  HL,N_PROGRAM
000451 E24A 1106DE          10      LD  DE,COMSTR
000454 E24D 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000456 E24F CD7DF3          17      CALL    BDOS
000459 E252 1106DE          10      LD  DE,COMSTR
00045C E255 0E43             7      LD  C,043H      ;(BDOS)ファイルハンドルのオープン
00045E E257 CD7DF3          17      CALL    BDOS
000461 E25A E1              10      POP HL
000462 E25B B7               4      OR  A
000463 E25C D1              10      POP DE
000464 E25D 206E            12      JR  NZ,WBOOT1
000466 E25F 7C               4      LD  A,H
000467 E260 12               7      LD  (DE),A
000468 E261 D5              11      PUSH    DE
000469 E262 C5              11      PUSH    BC
00046A E263 110001          10      LD  DE,00100H
00046D E266 2103DC          10      LD  HL,BDOS0-00100H
000470 E269 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し
000472 E26B CD7DF3          17      CALL    BDOS
000475 E26E C1              10      POP BC
000476 E26F 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ
000478 E271 CD7DF3          17      CALL    BDOS
00047B E274 D1              10      POP DE
00047C E275 215C00          10      LD  HL,FCB1
       E278                     ZERO1:
00047F E278 74               7      LD  (HL),H
000480 E279 2C               4      INC L
000481 E27A 20FC            12      JR  NZ,ZERO1
                                
000483 E27C 0600             7      LD  B,0
000485 E27E 218100          10      LD  HL,DTA1+1
       E281                     PARAM1:
000488 E281 1A               7      LD  A,(DE)
000489 E282 77               7      LD  (HL),A
00048A E283 B7               4      OR  A
00048B E284 2805            12      JR  Z,PARAM2
00048D E286 13               6      INC DE
00048E E287 23               6      INC HL
00048F E288 04               4      INC B
000490 E289 18F6            12      JR  PARAM1
       E28B                     PARAM2:
000492 E28B 78               4      LD  A,B
000493 E28C 328000          13      LD  (DTA1),A
                                
000496 E28F 118100          10      LD  DE,DTA1+1
000499 E292 CD12E3          17      CALL    FILE
00049C E295 D5              11      PUSH    DE
00049D E296 2106DD          10      LD  HL,FDRV
0004A0 E299 115C00          10      LD  DE,FCB1
0004A3 E29C 011000          10      LD  BC,00010H
0004A6 E29F EDB0                    LDIR
0004A8 E2A1 D1              10      POP DE
0004A9 E2A2 216C00          10      LD  HL,FCB2
0004AC E2A5 CD12E3          17      CALL    FILE
0004AF E2A8 2106DD          10      LD  HL,FDRV
0004B2 E2AB 116C00          10      LD  DE,FCB2
0004B5 E2AE 011000          10      LD  BC,00010H
0004B8 E2B1 EDB0                    LDIR
0004BA E2B3 219DE3          10      LD  HL,N_PARAMETERS
0004BD E2B6 118100          10      LD  DE,DTA1+1
0004C0 E2B9 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0004C2 E2BB CD7DF3          17      CALL    BDOS
0004C5 E2BE AF               4      XOR A
0004C6 E2BF 6F               4      LD  L,A
0004C7 E2C0 67               4      LD  H,A
0004C8 E2C1 32ADE3          13      LD  (TERMCODE),A
0004CB E2C4 229FE1          16      LD  (DEFAB),HL
0004CE E2C7 3103DD          10      LD  SP,BDOS0
0004D1 E2CA CD0001          17      CALL    00100H
       E2CD                     WBOOT1:
0004D4 E2CD F3               4      DI
0004D5 E2CE ED7BAEE3        20      LD  SP,(BASSP)
                                
0004D9 E2D2 2680             7      LD  H,080H          ;ページ3を復元
0004DB E2D4 3A16E4          13      LD  A,(BACKUP_RAM_3)
0004DE E2D7 CD2BE4          17      CALL    MAPPER_PUT_PH
0004E1 E2DA 210080          10      LD  HL,08000H
0004E4 E2DD 1100C0          10      LD  DE,0C000H
0004E7 E2E0 01031D          10      LD  BC,BDOS0-0C000H
0004EA E2E3 EDB0                    LDIR
                                
0004EC E2E5 2680             7      LD  H,080H          ;ページ2をBASICのRAMに
0004EE E2E7 3A11E4          13      LD  A,(BASIC_RAM_2)
0004F1 E2EA CD2BE4          17      CALL    MAPPER_PUT_PH
                                
0004F4 E2ED 2600             7      LD  H,000H      ;ページ0
0004F6 E2EF 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMスロット
0004F9 E2F2 CD2400          17      CALL    _ENASLT     ;ページ0をBIOSに切り替える(RAMのENASLTはページ0切り替え可能)
0004FC E2F5 2600             7      LD  H,000H          ;ページ0をBASICのRAMに
0004FE E2F7 3A0FE4          13      LD  A,(BASIC_RAM_0)
000501 E2FA CD2BE4          17      CALL    MAPPER_PUT_PH
                                
000504 E2FD 2640             7      LD  H,040H          ;ページ1をBASICのRAMに
000506 E2FF 3A10E4          13      LD  A,(BASIC_RAM_1)
000509 E302 CD2BE4          17      CALL    MAPPER_PUT_PH
00050C E305 3AC1FC          13      LD  A,(EXPTBL)  ;メインROMスロット
00050F E308 CD2400          17      CALL    _ENASLT     ;ページ1をBIOSに切り替える
                                
000512 E30B AF               4      XOR A
000513 E30C 32A9FC          13      LD  (CSRSW),A
                                
000516 E30F E1              10      POP HL
000517 E310 FB               4      EI
000518 E311 C9              10      RET
                                
       E312                     FILE:               ;DOS2
000519 E312 CD30E3          17      CALL    SPCUT
00051C E315 D5              11      PUSH    DE
00051D E316 0E5B             7      LD  C,05BH      ;(BDOS) パス名の解析
00051F E318 CD7DF3          17      CALL    BDOS
000522 E31B D1              10      POP DE
000523 E31C 13               6      INC DE
000524 E31D 1A               7      LD  A,(DE)
000525 E31E FE3A             7      CP  ':'
000527 E320 2004            12      JR  NZ,FILED2_1
000529 E322 79               4      LD  A,C
00052A E323 3206DD          13      LD  (FDRV),A
       E326                     FILED2_1:
00052D E326 EB               4      EX  DE,HL
00052E E327 2107DD          10      LD  HL,FNAME
000531 E32A 0E5C             7      LD  C,05CH      ;(BDOS) ファイル名の解析
000533 E32C C37DF3          10      JP  BDOS
                                
       E32F                     SS1:
000536 E32F 13               6      INC DE
       E330                     SPCUT:              ;スペースをカット
000537 E330 1A               7      LD  A,(DE)
000538 E331 FE20             7      CP  020H
00053A E333 28FA            12      JR  Z,SS1
00053C E335 C9              10      RET
                                
       E336                     CAP:
00053D E336 FE61             7      CP  'a'
00053F E338 D8              11      RET C
000540 E339 FE7B             7      CP  'z'+1
000542 E33B D0              11      RET NC
000543 E33C D620             7      SUB 020H
000545 E33E C9              10      RET
       E33F                     CAP2:
000546 E33F CD36E3          17      CALL    CAP
       E342                     CAP3:
000549 E342 CD4BE3          17      CALL    CAP4
00054C E345 FE21             7      CP  021H
00054E E347 D0              11      RET NC
00054F E348 3E20             7      LD  A,020H
000551 E34A C9              10      RET
       E34B                     CAP4:
000552 E34B FE05             7      CP  5
000554 E34D C0              11      RET NZ
000555 E34E 3EE5             7      LD  A,0E5H
000557 E350 C9              10      RET
                                
       E351                     CALSLT_BIOS:
000558 E351 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00055C E355 C31C00          10      JP  _CALSLT
                                
                                ;
                                ;ページ0専門のENASLT
                                ;in
                                ;A←スロット
                                ;破壊
                                ;ABCHL
                                ;
                                ; ページ0,3以外に転送して実行するのでリロケータブルに作る
       E358                     ENASLT_00H:
00055F E358 F3               4      DI
000560 E359 67               4      LD  H,A
000561 E35A E603             7      AND 3
000563 E35C 4F               4      LD  C,A
000564 E35D DBA8            11      IN  A,(0A8H)
000566 E35F 06FC             7      LD  B,0FCH  ;ページ0
000568 E361 A0               4      AND B
000569 E362 B1               4      OR  C
00056A E363 CB7C             8      BIT 7,H
00056C E365 CA89F3          10      JP  Z,ENASLT_NOEXT
                                                ;拡張スロットの処理
00056F E368 D5              11      PUSH    DE
000570 E369 57               4      LD  D,A ;基本スロットに出力する値
                                            ;対象の拡張スロットを切り替えるために基本スロットを切り替える
000571 E36A 7C               4      LD  A,H
000572 E36B E603             7      AND 3
000574 E36D 4F               4      LD  C,A ;C=スロット#
                                
                                    ;スロットテーブル
000575 E36E 2EC5             7      LD  L,LOW SLTTBL
000577 E370 85               4      ADD A,L
000578 E371 6F               4      LD  L,A
                                            ;対象の拡張スロットを切り替えるために基本スロットを切り替える
000579 E372 79               4      LD  A,C ;C=スロット#
00057A E373 0F               4      RRCA
00057B E374 0F               4      RRCA        ;ページ3
00057C E375 4F               4      LD  C,A
00057D E376 7A               4      LD  A,D ;基本スロットに出力する値
00057E E377 E63F             7      AND 03FH    ;ページ3マスク
000580 E379 B1               4      OR  C
000581 E37A 5F               4      LD  E,A ;基本スロットでページ3にスロットを割り当てる
000582 E37B 7C               4      LD  A,H
000583 E37C E60C             7      AND 00CH
000585 E37E 26FC             7      LD  H,HIGH SLTTBL
000587 E380 0F               4      RRCA
000588 E381 0F               4      RRCA
000589 E382 4F               4      LD  C,A
00058A E383 7B               4      LD  A,E
00058B E384 D3A8            11      OUT (0A8H),A
00058D E386 3AFFFF          13      LD  A,(0FFFFH)  ;拡張スロットの切り替え
000590 E389 2F               4      CPL
000591 E38A A0               4      AND B
000592 E38B B1               4      OR  C
000593 E38C 32FFFF          13      LD  (0FFFFH),A
000596 E38F 77               7      LD  (HL),A
                                                ;基本スロットの切り替え
000597 E390 7A               4      LD  A,D
000598 E391 D3A8            11      OUT (0A8H),A
00059A E393 D1              10      POP DE
00059B E394 C9              10      RET
       E395                     ENASLT_00H_E:
                                
       E395                     N_PROGRAM:
00059C E395 50524F4752414D00        DB  "PROGRAM",0
       E39D                     N_PARAMETERS:
0005A4 E39D 504152414D455445        DB  "PARAMETERS",0
            525300              
       E3A8                     COM_EXT:
0005AF E3A8 2E434F4D00              DB  ".COM",0
       E3AD                     TERMCODE:
0005B4 E3AD 00                      DB  0
       E3AE                     BASSP:
0005B5 E3AE 0000                    DW  0
[EOF:CMD.ASM:UTF_8]
                                    INCLUDE "BIOS.ASM"
                                ;
                                ;   Tablacus DOS cmd
                                ;
0005B7 E3B0                         ALIGN   256 ;0C000Hに配置
                                ;           下位1バイト0になるように
       E400                     CPM_BOOT:
000607 E400 C3CDE2          10      JP  WBOOT1
       E403                     CPM_WBOOT:
00060A E403 C3CDE2          10      JP  WBOOT1
       E406                     CPM_CONST:          ;(BDOS)コンソール直接入力
00060D E406 C3E6E0          10      JP  CONST1
       E409                     CPM_CONIN:
000610 E409 C3EBE0          10      JP  CONIN1
       E40C                     CPM_CONOUT:
000613 E40C C3F0E0          10      JP  CONOUT1
                                
       E40F                     RAM_TABLE:
       E40F                     BASIC_RAM_0 EQU RAM_TABLE
       E410                     BASIC_RAM_1 EQU RAM_TABLE+1
       E411                     BASIC_RAM_2 EQU RAM_TABLE+2
       E412                     COMMON_RAM_3    EQU RAM_TABLE+3
       E413                     DOS_RAM_0   EQU RAM_TABLE+4
       E414                     DOS_RAM_1   EQU RAM_TABLE+5
       E415                     DOS_RAM_2   EQU RAM_TABLE+6
       E416                     BACKUP_RAM_3    EQU RAM_TABLE+7
                                
       E417                     MMAP_TABLE_PTR  EQU RAM_TABLE+8
       E419                     MAPPER_JUMP_TABLE   EQU MMAP_TABLE_PTR+2
       E419                     MAPPER_ALL_SEG  EQU MAPPER_JUMP_TABLE
       E42B                     MAPPER_PUT_PH   EQU MAPPER_JUMP_TABLE+012H
       E42E                     MAPPER_GET_PH   EQU MAPPER_JUMP_TABLE+015H
[EOF:BIOS.ASM:UTF_8]
       E40F                     LAST:
[EOF:DOSCMD2.ASM:UTF_8]
